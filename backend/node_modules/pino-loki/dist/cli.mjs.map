{"version":3,"file":"cli.mjs","names":["current: any","options","#propsToLabels","options","#levelMap","value","labels: Record<string, string>","result: Record<string, string>","#buildTimestamp","#buildLabelsFromProps","#buildStructuredMetadata","#stringifyLog","#options","options","#logBuilder","#handleFailure","options","batchInterval: NodeJS.Timeout | undefined","pinoLogBuffer: PinoLog[]","headerObject: Record<string, string>","pkg.version","config: LokiOptions"],"sources":["../src/cli/args.ts","../src/debug.ts","../src/constants.ts","../src/get.ts","../src/format_mesage.ts","../src/log_builder.ts","../src/log_pusher.ts","../src/index.ts","../src/cli/print_help.ts","../package.json","../src/cli/index.ts"],"sourcesContent":["import type { ParseArgsOptionDescriptor, ParseArgsOptionsConfig } from 'node:util'\n\ninterface CustomParseArgsOptionDescriptor extends ParseArgsOptionDescriptor {\n  help?: string\n}\n\nexport interface CustomParseArgsOptionsConfig extends ParseArgsOptionsConfig {\n  [longOption: string]: CustomParseArgsOptionDescriptor\n}\n\nexport const options = {\n  'version': {\n    type: 'boolean',\n    short: 'v',\n    help: `Print version number and exit`,\n  },\n  'user': {\n    type: 'string',\n    short: 'u',\n    help: 'Loki username',\n  },\n  'password': {\n    type: 'string',\n    short: 'p',\n    help: 'Loki password',\n  },\n  'hostname': {\n    type: 'string',\n    default: 'http://localhost:3100',\n    help: 'URL for Loki',\n  },\n  'endpoint': {\n    type: 'string',\n    default: '/loki/api/v1/push',\n    help: 'Path to the Loki push API',\n  },\n  'batching': {\n    type: 'boolean',\n    default: true,\n    short: 'b',\n    help: 'Should logs be sent in batch mode',\n  },\n  'batching-interval': {\n    type: 'string',\n    default: '5',\n    short: 'i',\n    help: 'The interval at which batched logs are sent in seconds',\n  },\n  'batching-max-buffer-size': {\n    type: 'string',\n    default: '10000',\n    help: 'Maximum number of logs to buffer (0 for unlimited)',\n  },\n  'timeout': {\n    type: 'string',\n    default: '30000',\n    short: 't',\n    help: 'Timeout for request to Loki in ms',\n  },\n  'silenceErrors': {\n    type: 'boolean',\n    default: false,\n    short: 's',\n    help: 'If false, errors will be displayed in the console',\n  },\n  'replaceTimestamp': {\n    type: 'boolean',\n    default: false,\n    short: 'r',\n    help: 'Replace pino logs timestamps with Date.now()',\n  },\n  'labels': { type: 'string', short: 'l', help: 'Additional labels to be added to all Loki logs' },\n  'convertArrays': {\n    type: 'boolean',\n    default: false,\n    help: 'If true, arrays will be converted to objects',\n  },\n  'structuredMetaKey': {\n    type: 'string',\n    default: 'meta',\n    help: 'Key to use for structured metadata (use \"false\" to disable)',\n  },\n  'propsLabels': {\n    type: 'string',\n    help: 'Fields in log line to convert to Loki labels (comma separated values)',\n  },\n  'headers': {\n    type: 'string',\n    help: 'Custom headers to be sent with the request to Loki (comma separated key=value pairs)',\n  },\n  'help': {\n    type: 'boolean',\n    short: 'h',\n    default: false,\n    help: 'Print this help message and exit',\n  },\n} as const\n","import { debuglog } from 'node:util'\n\nexport default debuglog('pino-loki')\n","/* eslint-disable @typescript-eslint/no-redeclare */\nexport const LokiLogLevel = {\n  Info: 'info',\n  Debug: 'debug',\n  Error: 'error',\n  Warning: 'warning',\n  Critical: 'critical',\n} as const\n\nexport type LokiLogLevel = (typeof LokiLogLevel)[keyof typeof LokiLogLevel]\n","/**\n * Dynamically get a nested value from an array or object with a\n * string.\n */\nexport function get<TDefault = unknown>(\n  value: any,\n  path: string,\n  defaultValue?: TDefault,\n): TDefault {\n  const segments = path.split(/[.[\\]]/g)\n  let current: any = value\n\n  for (const key of segments) {\n    if (current === null) return defaultValue as TDefault\n    if (current === undefined) return defaultValue as TDefault\n\n    const unquotedKey = key.replace(/[\"']/g, '')\n    if (unquotedKey.trim() === '') continue\n\n    current = current[unquotedKey]\n  }\n\n  if (current === undefined) return defaultValue as TDefault\n  return current\n}\n","import { get } from './get.ts'\nimport type { LogFormat, LogFormatExpectedObject } from './types.ts'\n\nexport function formatLog(options: { log: LogFormatExpectedObject; logFormat: LogFormat }): string {\n  const { log, logFormat } = options\n\n  if (logFormat && typeof logFormat === 'string') {\n    return logFormat.replace(/{([^{}]+)}/g, (_match, p1) => get(log, p1) || '')\n  }\n\n  if (logFormat && typeof logFormat === 'function') {\n    return logFormat(options.log)\n  }\n\n  throw new Error('Message format must be a string or a function. Received: ' + typeof logFormat)\n}\n","import { LokiLogLevel } from './constants.ts'\nimport { formatLog } from './format_mesage.ts'\nimport type { LokiLog, PinoLog, LokiOptions, LogFormat, LogFormatExpectedObject } from './types.ts'\n\nconst NANOSECONDS_LENGTH = 19\n\ntype BuilderOptions = Pick<LokiOptions, 'propsToLabels' | 'levelMap'>\n\n/**\n * Converts a Pino log to a Loki log\n */\nexport class LogBuilder {\n  #propsToLabels: string[]\n  #levelMap: { [key: number]: LokiLogLevel }\n\n  constructor(options?: BuilderOptions) {\n    this.#propsToLabels = options?.propsToLabels || []\n    this.#levelMap = Object.assign(\n      {\n        10: LokiLogLevel.Debug,\n        20: LokiLogLevel.Debug,\n        30: LokiLogLevel.Info,\n        40: LokiLogLevel.Warning,\n        50: LokiLogLevel.Error,\n        60: LokiLogLevel.Critical,\n      },\n      options?.levelMap,\n    )\n  }\n\n  /**\n   * Builds a timestamp string from a Pino log object.\n   * @returns A string representing the timestamp in nanoseconds.\n   */\n  #buildTimestamp(log: PinoLog, replaceTimestamp?: boolean): string {\n    if (replaceTimestamp) {\n      return (new Date().getTime() * 1_000_000).toString()\n    }\n\n    const time = log.time || Date.now()\n    const strTime = time.toString()\n\n    // Returns the time if it's already in nanoseconds\n    if (strTime.length === NANOSECONDS_LENGTH) {\n      return strTime\n    }\n\n    // Otherwise, find the missing factor to convert it to nanoseconds\n    const missingFactor = 10 ** (19 - strTime.length)\n    return (time * missingFactor).toString()\n  }\n\n  /**\n   * Stringify the log object. If convertArrays is true then it will convert\n   * arrays to objects with indexes as keys.\n   */\n  #stringifyLog(log: PinoLog, convertArrays?: boolean): string {\n    return JSON.stringify(log, (_, value) => {\n      if (!convertArrays) return value\n\n      if (Array.isArray(value)) {\n        return Object.fromEntries(value.map((value, index) => [index, value]))\n      }\n\n      return value\n    })\n  }\n\n  #buildLabelsFromProps(log: PinoLog) {\n    const labels: Record<string, string> = {}\n\n    for (const prop of this.#propsToLabels) {\n      if (log[prop]) {\n        labels[prop] = log[prop]\n      }\n    }\n\n    return labels\n  }\n\n  /**\n   * Loki structured metadata requires string values only.\n   */\n  #buildStructuredMetadata(\n    log: PinoLog,\n    structuredMetaKey?: string | false,\n  ): Record<string, string> | undefined {\n    if (!structuredMetaKey) return undefined\n\n    const meta = log[structuredMetaKey]\n    if (!meta || typeof meta !== 'object') return undefined\n\n    const result: Record<string, string> = {}\n    for (const [key, value] of Object.entries(meta)) {\n      if (typeof value === 'string') result[key] = value\n      else if (typeof value === 'object' && value !== null) result[key] = JSON.stringify(value)\n      else result[key] = String(value)\n    }\n\n    return result\n  }\n\n  /**\n   * Convert a level to a human readable status\n   */\n  statusFromLevel(level: number) {\n    return this.#levelMap[level] || LokiLogLevel.Info\n  }\n\n  /**\n   * Build a loki log entry from a pino log\n   */\n  build(options: {\n    log: PinoLog\n    replaceTimestamp?: boolean\n    additionalLabels?: Record<string, string>\n    convertArrays?: boolean\n    structuredMetaKey?: string | false\n    logFormat?: LogFormat\n  }): LokiLog {\n    const { hostname, ...logWithoutHostname } = options.log\n\n    const status = this.statusFromLevel(options.log.level)\n    const time = this.#buildTimestamp(options.log, options.replaceTimestamp)\n    const propsLabels = this.#buildLabelsFromProps(options.log)\n    const structuredMetadata = this.#buildStructuredMetadata(options.log, options.structuredMetaKey)\n\n    const formattedMessage = options.logFormat\n      ? formatLog({\n          logFormat: options.logFormat,\n          log: { ...logWithoutHostname, lokilevel: status } as LogFormatExpectedObject,\n        })\n      : this.#stringifyLog(logWithoutHostname, options.convertArrays)\n\n    return {\n      stream: {\n        level: status,\n        hostname,\n        ...options.additionalLabels,\n        ...propsLabels,\n      },\n      values: [\n        // Make sure to exclude structured metadata from the log object\n        // if not present because olders versions of Loki will not accept\n        // it and will return an error.\n        structuredMetadata\n          ? [time, formattedMessage, structuredMetadata]\n          : [time, formattedMessage],\n      ],\n    }\n  }\n}\n","import debug from './debug.ts'\nimport { LogBuilder } from './log_builder.ts'\nimport type { PinoLog, LokiOptions } from './types.ts'\n\nclass RequestError extends Error {\n  responseBody: string\n\n  constructor(message: string, responseBody: string) {\n    super(message)\n    this.name = 'RequestError'\n    this.responseBody = responseBody\n  }\n}\n\n/**\n * Responsible for pushing logs to Loki\n */\nexport class LogPusher {\n  #options: LokiOptions\n  #logBuilder: LogBuilder\n\n  constructor(options: LokiOptions) {\n    this.#options = options\n\n    this.#logBuilder = new LogBuilder({\n      levelMap: options.levelMap,\n      propsToLabels: options.propsToLabels,\n    })\n  }\n\n  /**\n   * Handle push failures\n   */\n  #handleFailure(err: any) {\n    if (this.#options.silenceErrors === true) {\n      return\n    }\n\n    if (err instanceof RequestError) {\n      console.error(err.message + '\\n' + err.responseBody)\n      return\n    }\n\n    console.error('Got unknown error when trying to send log to Loki, error output:', err)\n  }\n\n  /**\n   * Push one or multiples logs entries to Loki\n   */\n  async push(logs: PinoLog[] | PinoLog) {\n    if (!Array.isArray(logs)) {\n      logs = [logs]\n    }\n\n    const lokiLogs = logs.map((log) =>\n      this.#logBuilder.build({\n        log,\n        replaceTimestamp: this.#options.replaceTimestamp,\n        additionalLabels: this.#options.labels,\n        convertArrays: this.#options.convertArrays,\n        structuredMetaKey: this.#options.structuredMetaKey,\n        logFormat: this.#options.logFormat,\n      }),\n    )\n\n    debug(`[LogPusher] pushing ${lokiLogs.length} logs to Loki`)\n\n    try {\n      const response = await fetch(\n        new URL(this.#options.endpoint ?? 'loki/api/v1/push', this.#options.host),\n        {\n          method: 'POST',\n          signal: AbortSignal.timeout(this.#options.timeout ?? 30_000),\n          headers: {\n            ...this.#options.headers,\n            ...(this.#options.basicAuth && {\n              Authorization:\n                'Basic ' +\n                Buffer.from(\n                  `${this.#options.basicAuth.username}:${this.#options.basicAuth.password}`,\n                ).toString('base64'),\n            }),\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ streams: lokiLogs }),\n        },\n      )\n\n      if (!response.ok) {\n        throw new RequestError('Got error when trying to send log to loki', await response.text())\n      }\n    } catch (err) {\n      this.#handleFailure(err)\n    }\n\n    debug(`[LogPusher] pushed ${lokiLogs.length} logs to Loki`, { logs: lokiLogs })\n  }\n}\n","import abstractTransportBuild from 'pino-abstract-transport'\n\nimport debug from './debug.ts'\nimport { LogPusher } from './log_pusher.ts'\nimport { LokiLogLevel } from './constants.ts'\nimport type { PinoLog, LokiOptions, BatchingOptions } from './types.ts'\n\ninterface ResolvedBatching {\n  enabled: boolean\n  interval: number\n  maxBufferSize: number\n}\n\nfunction resolveBatching(batching: LokiOptions['batching']): ResolvedBatching {\n  if (batching === false) return { enabled: false, interval: 5, maxBufferSize: 10_000 }\n\n  return {\n    enabled: true,\n    interval: batching?.interval ?? 5,\n    maxBufferSize: batching?.maxBufferSize ?? 10_000,\n  }\n}\n\n/**\n * Resolves the options for the Pino Loki transport\n */\nfunction resolveOptions(options: LokiOptions) {\n  return {\n    ...options,\n    endpoint: options.endpoint ?? 'loki/api/v1/push',\n    timeout: options.timeout ?? 30_000,\n    silenceErrors: options.silenceErrors ?? false,\n    batching: resolveBatching(options.batching),\n    replaceTimestamp: options.replaceTimestamp ?? false,\n    propsToLabels: options.propsToLabels ?? [],\n    convertArrays: options.convertArrays ?? false,\n    structuredMetaKey:\n      options.structuredMetaKey === false ? undefined : (options.structuredMetaKey ?? 'meta'),\n    logFormat: options.logFormat,\n  }\n}\n\nfunction pinoLoki(userOptions: LokiOptions) {\n  const options = resolveOptions(userOptions)\n  const logPusher = new LogPusher(options)\n\n  const { basicAuth: _, ...safeOptions } = options\n  debug(`[PinoLoki] initialized with options: ${JSON.stringify(safeOptions)}`)\n\n  let batchInterval: NodeJS.Timeout | undefined\n  let pinoLogBuffer: PinoLog[] = []\n  let isClosed = false\n\n  return abstractTransportBuild(\n    async (source) => {\n      if (options.batching.enabled) {\n        batchInterval = setInterval(() => {\n          if (isClosed) return\n\n          debug(`Batch interval reached, sending ${pinoLogBuffer.length} logs to Loki`)\n\n          if (pinoLogBuffer.length === 0) return\n\n          const logsToSend = pinoLogBuffer\n          pinoLogBuffer = []\n          logPusher.push(logsToSend)\n        }, options.batching.interval * 1000)\n      }\n\n      for await (const obj of source) {\n        if (options.batching.enabled) {\n          if (\n            options.batching.maxBufferSize > 0 &&\n            pinoLogBuffer.length >= options.batching.maxBufferSize\n          ) {\n            const dropped = pinoLogBuffer.shift()\n            debug(`[PinoLoki] Buffer full, dropping oldest log: ${JSON.stringify(dropped)}`)\n          }\n          pinoLogBuffer.push(obj)\n          continue\n        }\n\n        logPusher.push(obj)\n      }\n    },\n    {\n      /**\n       * When transport is closed, push remaining logs to Loki\n       * and clear the interval\n       */\n      async close() {\n        if (options.batching.enabled) {\n          isClosed = true\n          clearInterval(batchInterval!)\n\n          if (pinoLogBuffer.length > 0) {\n            await logPusher.push(pinoLogBuffer)\n          }\n        }\n      },\n    },\n  )\n}\n\nexport default pinoLoki\nexport { LokiLogLevel, pinoLoki, type LokiOptions, type PinoLog, type BatchingOptions }\n","import type { CustomParseArgsOptionsConfig } from './args.ts'\n\nexport function printHelp(opts: CustomParseArgsOptionsConfig) {\n  console.log(`Usage: pino-loki [options]\\n\\nOptions:`)\n\n  const flagsData = Object.entries(opts).map(([key, option]) => ({\n    flags:\n      (option.short ? `-${option.short}, --${key}` : `--${key}`) +\n      (option.type === 'boolean' ? '' : ` <value>`),\n    help: option.help,\n    default: option.default,\n  }))\n\n  const maxFlagsWidth = Math.max(...flagsData.map((item) => item.flags.length))\n\n  for (const { flags, help, default: defaultValue } of flagsData) {\n    const paddedFlags = flags.padEnd(maxFlagsWidth + 2)\n    const defaultText = defaultValue ? ` (default: ${defaultValue})` : ''\n\n    console.log(`  ${paddedFlags}${help}${defaultText}`)\n  }\n\n  console.log(\n    `\\nExample:\\n  pino-loki --hostname http://localhost:3100 --user myuser --password mypass --batch --interval 10`,\n  )\n}\n","{\n  \"name\": \"pino-loki\",\n  \"type\": \"module\",\n  \"version\": \"3.0.0\",\n  \"packageManager\": \"pnpm@10.25.0\",\n  \"description\": \"A transport for pino that sends messages to Loki\",\n  \"author\": \"Julien Ripouteau <julien@ripouteau.com>\",\n  \"license\": \"MIT\",\n  \"funding\": \"https://github.com/sponsors/Julien-R44\",\n  \"homepage\": \"https://github.com/Julien-R44/pino-loki#readme\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/Julien-R44/pino-loki.git\"\n  },\n  \"bugs\": {\n    \"url\": \"https://github.com/Julien-R44/pino-loki/issues\"\n  },\n  \"keywords\": [\n    \"pino\",\n    \"pino-transport\",\n    \"loki\",\n    \"logging\"\n  ],\n  \"exports\": {\n    \".\": {\n      \"import\": {\n        \"types\": \"./dist/index.d.mts\",\n        \"default\": \"./dist/index.mjs\"\n      },\n      \"require\": {\n        \"types\": \"./dist/index.d.cts\",\n        \"default\": \"./dist/index.cjs\"\n      }\n    },\n    \"./package.json\": \"./package.json\"\n  },\n  \"main\": \"./dist/index.cjs\",\n  \"module\": \"./dist/index.mjs\",\n  \"types\": \"./dist/index.d.mts\",\n  \"bin\": {\n    \"pino-loki\": \"dist/cli.mjs\"\n  },\n  \"files\": [\n    \"dist\"\n  ],\n  \"engines\": {\n    \"node\": \">=20\"\n  },\n  \"scripts\": {\n    \"build\": \"tsdown\",\n    \"lint\": \"eslint .\",\n    \"format\": \"prettier --write .\",\n    \"prepublishOnly\": \"pnpm build\",\n    \"release\": \"bumpp --commit --push --tag && pnpm publish\",\n    \"quick:test\": \"node --experimental-strip-types bin/test.ts\",\n    \"test\": \"c8 node --experimental-strip-types bin/test.ts\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"checks\": \"pnpm typecheck && pnpm lint && pnpm test\"\n  },\n  \"dependencies\": {\n    \"pino-abstract-transport\": \"^3.0.0\",\n    \"pump\": \"^3.0.3\"\n  },\n  \"devDependencies\": {\n    \"@japa/assert\": \"^4.2.0\",\n    \"@japa/runner\": \"^5.0.0\",\n    \"@japa/spec-reporter\": \"^1.3.3\",\n    \"@julr/tooling-configs\": \"^5.0.0\",\n    \"@types/node\": \"^25.0.2\",\n    \"@types/pump\": \"^1.1.3\",\n    \"bumpp\": \"^10.3.2\",\n    \"c8\": \"^10.1.3\",\n    \"dotenv\": \"^17.2.3\",\n    \"eslint\": \"^9.39.2\",\n    \"msw\": \"^2.12.4\",\n    \"pino\": \"^10.1.0\",\n    \"pino-pretty\": \"^13.1.3\",\n    \"prettier\": \"^3.7.4\",\n    \"tsdown\": \"^0.17.4\",\n    \"typescript\": \"^5.9.3\"\n  },\n  \"prettier\": \"@julr/tooling-configs/prettier\"\n}\n","#!/usr/bin/env node\n\nimport pump from 'pump'\nimport { parseArgs } from 'node:util'\n\nimport { options } from './args.ts'\nimport { pinoLoki } from '../index.ts'\nimport { printHelp } from './print_help.ts'\nimport type { LokiOptions } from '../types.ts'\nimport pkg from '../../package.json' with { type: 'json' }\n\nexport function validateHeaders(headers: string): Record<string, string> {\n  const headerPairs = headers.split(',').map((pair) => pair.trim())\n  const headerObject: Record<string, string> = {}\n\n  for (const pair of headerPairs) {\n    const [key, value] = pair.split('=').map((part) => part.trim())\n    if (!key || !value)\n      throw new Error(`Invalid header format: \"${pair}\". Expected format is \"key=value\".`)\n\n    headerObject[key] = value\n  }\n\n  return headerObject\n}\n\n/**\n * Create a PinoLokiOptionsContract from cli arguments\n */\nexport const createPinoLokiConfigFromArgs = () => {\n  const { values } = parseArgs({ options })\n\n  if (values.help) {\n    printHelp(options)\n    process.exit(0)\n  }\n\n  if (values.version) {\n    console.log(`v${pkg.version}`)\n    process.exit(0)\n  }\n\n  const propsLabels = (values.propsLabels ?? '')\n    .split(',')\n    .map((label) => label.trim())\n    .filter(Boolean)\n\n  const config: LokiOptions = {\n    host: values.hostname,\n    endpoint: values.endpoint,\n    timeout: values.timeout ? Number(values.timeout) : undefined,\n    silenceErrors: values.silenceErrors,\n    batching:\n      values.batching === false\n        ? false\n        : {\n            interval: values['batching-interval'] ? Number(values['batching-interval']) : undefined,\n            maxBufferSize: values['batching-max-buffer-size']\n              ? Number(values['batching-max-buffer-size'])\n              : undefined,\n          },\n    replaceTimestamp: values.replaceTimestamp,\n    labels: values.labels ? JSON.parse(values.labels) : undefined,\n    propsToLabels: propsLabels,\n    structuredMetaKey: values.structuredMetaKey === 'false' ? false : values.structuredMetaKey,\n    convertArrays: values.convertArrays,\n    headers: values.headers ? validateHeaders(values.headers) : undefined,\n  }\n\n  if (values.user && values.password) {\n    config.basicAuth = { username: values.user, password: values.password }\n  }\n\n  return config\n}\n\nfunction main() {\n  pump(process.stdin, pinoLoki(createPinoLokiConfigFromArgs()))\n}\n\nmain()\n"],"mappings":"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"}